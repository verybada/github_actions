name: Release 

on:
  push:
    tags:
      - '*'

jobs:
  check:
    uses: ./.github/workflows/check_subworkflow.yml
  pack:
    needs: check
    uses: ./.github/workflows/pack_subworkflow.yml
    with:
      image_tag: ${{github.ref_name}}
  dev:
    needs: pack
    uses: ./.github/workflows/deploy_subworkflow.yml
    with:
      site: dev
  stg:
    needs: dev 
    uses: ./.github/workflows/deploy_subworkflow.yml
    with:
      site: stg
  prod:
    needs: stg
    uses: ./.github/workflows/deploy_subworkflow.yml
    with:
      site: prod
